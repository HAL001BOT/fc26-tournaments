<!doctype html>
<html>
<head>
  <title><%= tournament.name %> - FC26 Tracker</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <header class="topbar">
    <h1><%= tournament.name %></h1>
    <a href="/dashboard">‚Üê Dashboard</a>
  </header>

  <section class="card">
    <h2>Standings</h2>
    <table>
      <thead>
        <tr><th>#</th><th>Player</th><th>Team</th><th>P</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>GD</th><th>Pts</th></tr>
      </thead>
      <tbody>
      <% standings.forEach((r, idx) => { %>
        <tr>
          <td><%= idx + 1 %></td>
          <td><%= r.playerName %></td>
          <td>
            <% if (r.team) { %>
              <img class="logo" src="<%= r.team.logo %>" alt="logo" /> <%= r.team.name %>
            <% } else { %>
              <%= r.teamId %>
            <% } %>
          </td>
          <td><%= r.played %></td><td><%= r.wins %></td><td><%= r.draws %></td><td><%= r.losses %></td>
          <td><%= r.goalsFor %></td><td><%= r.goalsAgainst %></td><td><%= r.goalDiff %></td><td><strong><%= r.points %></strong></td>
        </tr>
      <% }) %>
      </tbody>
    </table>
  </section>

  <section class="card">
    <h2>Tournament Statistics</h2>
    <ul>
      <li>Matches played: <strong><%= stats.matchesPlayed %> / <%= stats.totalMatches %></strong></li>
      <li>Total goals: <strong><%= stats.totalGoals %></strong></li>
      <li>Average goals per match: <strong><%= stats.avgGoals %></strong></li>
      <% if (stats.topAttack) { %><li>Top attack: <strong><%= stats.topAttack.playerName %></strong> (<%= stats.topAttack.goalsFor %> goals)</li><% } %>
      <% if (stats.bestDefense) { %><li>Best defense: <strong><%= stats.bestDefense.playerName %></strong> (<%= stats.bestDefense.goalsAgainst %> conceded)</li><% } %>
    </ul>
  </section>

  <section class="card">
    <h2>Fixtures & Results (Double Round-Robin)</h2>
    <div class="fixtures-grid">
      <% matches.forEach(m => { const played = !(m.home_goals === null || m.away_goals === null); %>
        <article class="fixture-card <%= played ? 'played' : 'pending' %>">
          <div class="fixture-top">
            <span class="round-pill">Round <%= m.round_no %></span>
            <span class="status-pill <%= played ? 'done' : 'upcoming' %>"><%= played ? 'Final' : 'Pending' %></span>
          </div>

          <div class="teams-line">
            <div class="team-side <%= played && m.home_goals > m.away_goals ? 'winner' : '' %>">
              <% if (m.home_team) { %><img class="logo" src="<%= m.home_team.logo %>" alt="logo" /><% } %>
              <div>
                <div class="player-name"><%= m.home_name %></div>
                <div class="team-name"><%= m.home_team?.name || m.home_team_id %></div>
              </div>
            </div>

            <div class="score-box <%= played ? 'show' : '' %>">
              <% if (played) { %>
                <strong><%= m.home_goals %> - <%= m.away_goals %></strong>
              <% } else { %>
                <span>vs</span>
              <% } %>
            </div>

            <div class="team-side right <%= played && m.away_goals > m.home_goals ? 'winner' : '' %>">
              <div>
                <div class="player-name"><%= m.away_name %></div>
                <div class="team-name"><%= m.away_team?.name || m.away_team_id %></div>
              </div>
              <% if (m.away_team) { %><img class="logo" src="<%= m.away_team.logo %>" alt="logo" /><% } %>
            </div>
          </div>

          <% if (!played) { %>
            <form method="post" action="/matches/<%= m.id %>/result" class="result-form">
              <input type="number" min="0" name="home_goals" required />
              <span>-</span>
              <input type="number" min="0" name="away_goals" required />
              <button type="submit">Save result</button>
            </form>
          <% } %>
        </article>
      <% }) %>
    </div>
  </section>
</body>
</html>
